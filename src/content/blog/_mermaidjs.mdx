---
title : "Vos sch√©mas en Markdown ? C‚Äôest possible avec MermaidJS"
date : Sep 4 2024
tags :
- Outils
description : "Test"
banner : "/assets/images/jakub-zerdzicki-ip7GFn5JqX8-unsplash.webp"
readingtime : "5 min"
author : "Jakub ≈ªerdzicki"
authorlink : "https://unsplash.com/fr/@jakubzerdzicki?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash"
unsplashlink : "https://unsplash.com/fr/photos/une-telecommande-posee-sur-une-table-ip7GFn5JqX8?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash"
isArticle : true
---
import Picture from "@components/Picture.astro";

import mermaidjsexample1 from "../../assets/images/mermaidjs-example1.png";
import mermaidjsexample2 from "../../assets/images/mermaidjs-example2.png";
import mermaidjsexample3 from "../../assets/images/mermaidjs-example3.png";
import mermaidjsexample4 from "../../assets/images/mermaidjs-example4.png";
import mermaidjsexample5 from "../../assets/images/mermaidjs-example5.png";

Vous en avez marre de cr√©er des sch√©mas d‚Äôinfrastructures, de processus au format image, mis √† jour r√©guli√®rement et tr√®s chronophage ?

Le code vous parle plus qu‚Äôun logiciel de dessin ? Le markdown n‚Äôa plus de secrets pour vous ? MermaisJS est fait pour vous !

## Pr√©-requis

Comme toujours avec un package npm, vous aurez besoin des outils suivants :

- NodeJS
- Un √©diteur de code
- Un terminal

Toutes les conditions sont remplies pour d√©marrer ? Passons √† l‚Äôinstallation !

## Installation

La m√©thode la plus simple pour utiliser MermaidJS est d‚Äôaller directement sur leur [
√©diteur de diagrammes en ligne](https://mermaid.live/edit), vous pouvez √©galement l‚Äôinstaller sur votre ordinateur, avec, comme souvent, une simple ligne de commande.

Ouvrez un terminal dans le dossier que vous souhaitez, puis ex√©cutez la commande suivante :

```bash
npm install -g @mermaid-js/mermaid-cli
```

La premi√®re partie de la commande indique √† npm qu‚Äôil doit installer un package, la deuxi√®me partie `-g` que l'installation est faite de mani√®re globale et la troisi√®me `@mermaid-js/mermaid-cli` que c'est la CLI de MermaidJS que vous installez.

Si vous souhaitez uniquement int√©grer MermaidJS √† une page web statique, vous pouvez simplement utiliser le CDN propos√©. Si vous copiez ce code dans un fichier html et que vous l‚Äôouvrez avec votre navigateur, vous aurez bien un diagramme et non l‚Äôaffichage brut du texte contenu dans les balise `<pre class="mermaid">`

```html
<html>
  <body>
    Voici un sch√©ma mermaid :
    <pre class="mermaid">
            graph TD
            A[Client] --> B[R√©partisseur de charge]
            B --> C[Serveur 1]
            B --> D[Serveur 2]
    </pre>

    Et un autre :
    <pre class="mermaid">
            graph TD
            A[Client] -->|tcp_123| B
            B(R√©partisseur de charge)
            B -->|tcp_456| C[Serveur 1]]
            B -->|tcp_456| D[Serveur 2]
    </pre>

    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
  </body>
</html>
```

Si vous souhaitez int√©grer des ic√¥nes √† vos diagrammes, vous pourrez utiliser le CDN de FontAwesome en ajoutant la balise <link></link> suivante √† l‚Äôint√©rieur de la balise <head></head> de votre page :

## La syntaxe MermaidJS

MermaidJS a une syntaxe sp√©cifique, qu‚Äôil convient de ma√Ætriser afin de r√©aliser vos diagrammes. En effet, si vous ne la respectez pas √† la lettre, vous vous trouverez face √† des erreurs sur votre terminal qui emp√™cheront la g√©n√©ration de vos images.

L‚Äôexemple suivant est un fichier MermaidJS, dont l‚Äôextension est **.mmd**.

```yaml
---
config:
  look:
  theme:
  fontFamily:
---
type orientation
	contenu
```

L‚Äôen-t√™te du fichier (entre deux lignes de 3 tirets) contient la configuration du diagramme. Plusieurs th√®mes sont nativement disponibles avec MermaidJS (‚Äùdefault‚Äù, ‚Äúbase‚Äù, ‚Äúdark‚Äù, ‚Äúforest‚Äù, ‚Äúneutral‚Äù). On peut √©galement d√©sactiver les th√®mes pr√©-d√©finis avec la valeur ‚Äúnull‚Äù. Le look du diagramme peut prendre 2 valeurs, ‚Äúclassic‚Äù ou ‚ÄúhandDrawn‚Äù, autrement dit automatique ou dessin√© √† la main.

Les orientations possibles sont les suivantes :

- TB - Top to bottom (de haut en bas)
- TD - Top-down (de haut en bas)
- BT - Bottom to top (de bas en haut)
- RL - Right to left
- LR - Left to right

Ce n‚Äôest qu‚Äôun aper√ßu des options disponibles, la configuration MermaidJS poss√©dant environ une cinquantaine d‚Äôoptions disponibles que vous pouvez retrouver ici https://mermaid.js.org/config/schema-docs/config.html.

## G√©n√©rer vos diagrammes

La moiti√© du travail est faite, il n‚Äôy a plus qu‚Äô√† comprendre comment g√©n√©rer des diagrammes. MermaidJS peut g√©n√©rer l‚Äôimage d‚Äôun diagramme √† partir d‚Äôun extrait de ‚Äúcode‚Äù qu‚Äôil va traduire en une image au format svg. La commande qui va r√©aliser l‚Äôop√©ration est la suivante :

```bash
mmdc --input monfichier.md --output monfichier.svg
```

Ici, mmdc est la commande MermaidJS  qui permet de g√©n√©rer les diagrammes. Elle prend 2 arguments :

- `--input` le fichier d'entr√©e (avec le code des diagrammes) : .mmd ou .md
- `--output` le fichier de sortie (avec le diagramme g√©n√©r√©) : .svg (par d√©faut), .png, .md

Dans le cas du Markdown, on peut noter qu‚Äôil n‚Äôest pas n√©cessaire d‚Äôutiliser 2 fichiers distincts pour l‚Äôentr√©e et la sortie. Un fichier .md peut √™tre trait√© par la commande Mermaid mmdc et directement modifi√©.

Si le fichier d‚Äôentr√©e ressemble √† ceci avant de jouer la commande mmdc

```
### Diagramme 1

graph
   [....]

### Diagramme 2

sequenceDiagram
   [....]

```

Apr√®s l‚Äôex√©cution de la commande mmdc, il ressemblera √† ceci.

```markdown
### Diagramme 1
![diagram](./readme-1.svg)

### Diagramme 2
![diagram](./readme-2.svg)

### Diagramme avec titre et description personnalis√©s
![Description](./readme-3.svg "Titre")
```

La structure du fichier reste la m√™me, mais les diagrammes ont √©t√© remplac√©s par les images g√©n√©r√©es par le script.

Vos diagrammes vous paraissent un peu ternes et manquent de couleur ? MermaidJS a pens√© √† tout !

## Personnaliser vos diagrammes

Je vais ici m‚Äôint√©resser aux diagrammes de flux. Vous aurez ainsi un aper√ßu des possibilit√©s de MermaidJS, la logique d‚Äô√©criture du code √©tant globalement la m√™me d‚Äôun type de diagrammes √† un autre.

Si vous souhaitez appliquer des couleurs personnalis√©es √† vos √©l√©ments, leurs bordures, votre texte etc. vous pouvez utiliser le th√®me ‚Äúbase‚Äù dont nous avons parl√© plus haut. En effet, il est le seul √† √™tre modifiable. Avec ce th√®me, vous pouvez d√©finir les variables de th√®me que vous souhaitez.

Si on prend un diagramme sans th√®me personnalis√©, on aura ceci :

```mermaid
---
config:
  look: classic
  theme: dark
  fontFamily: sans-serif
---
flowchart LR
  A[Fichier mmd] --> B[Fichier png ou svg]
  C[Fichier md] --> D[Fichier md + svg]
```

<Picture image={mermaidjsexample1.png} caption="Diagramme avec le style de base de MermaidJS" />

Si vous souhaitez personnaliser le style de notre diagramme (qu‚Äôil s‚Äôagisse d‚Äôun diagramme de flux ou d‚Äôun autre type de diagramme), vous pouvez utiliser le code suivant. Il n‚Äôexiste qu‚Äôun seul th√®me natif personnalisable, il s‚Äôagit du th√®me ‚Äúbase‚Äù.

```mermaid
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'primaryColor': '#BB2528',
      'primaryTextColor': '#fff',
      'primaryBorderColor': '#7C0000',
      'lineColor': '#F8B229',
      'secondaryColor': '#006100',
      'tertiaryColor': '#fff',

    }
  }
}%%
---
config:
  look: classic
  fontFamily: sans-serif
---
flowchart LR
  A[Fichier mmd] --> B[Fichier png ou svg]
  C[Fichier md] --> D[Fichier md + svg]
```

Il existe une grande vari√©t√© de variables de th√®mes permettant de personnaliser vos diagrammes, de la couleur d‚Äôarri√®re-plan au style des bordures en passant par les polices d‚Äô√©criture, bien assez pour vous amuser un moment üòâ !

Chaque type de diagrammes a son lot de themeVariables sp√©cifique, vous ne pourrez pas simplement copier-coller vos styles d‚Äôun diagrammes √† un autre. La documentation est l√† pour vous guider (https://mermaid.js.org/config/theming.html), et elle est tr√®s bien faite !

```mermaid
---
config:
  theme:forest
---
flowchart TD
  A[A] --> B[B]
  C[C] --- D[D]
  E[E] --- F[F]
```

<Picture image={mermaidjsexample2} caption="" />


Trop de rectangles tuent les diagrammes, c‚Äôest bien connu ! Pourquoi ne pas varier la forme des √©l√©ments de vos diagrammes ?

```mermaid
flowchart LR
	A[A] --> B{B} --> C(C) --> D([D]) --> E[(E)] --> F((F)) --> G[[G]]
  H{{H}} --> I>I] --> J[/J/] -->	K[\K\] -->	L[/L\] --> M[\M/] --> N(((N)))
```


<Picture image={mermaidjsexample3} caption="" />

MermaidJS pr√©sente √©galement une grande vari√©t√© de liens, et les boucles ne posent pas de probl√®me. Les liens peuvent porter du texte, la syntaxe √©tant l√©g√®rement diff√©rente.

```mermaid
flowchart LR
	A-->B--texte-->C-- texte ---D -- texte --> E
	F-.- G -.texte.- H ==> I == texte === J == texte ==> K --> J
```

<Picture image={mermaidjsexample4} caption="" />

On peut √©galement cr√©er des sous-graphes, qui permettent de regrouper visuellement des √©l√©ments comme appartenant √† une seule entit√©, √† un seul bloc.

```mermaid
flowchart TB
    c1-->a2
    subgraph subgraph 1
    a1-->a2
    end
    subgraph subgraph 2
    b1-->b2
    end
    subgraph subgraph 3
    c1-->c2
    end
```

<Picture image={mermaidjsexample5} caption="Exemple de sch√©ma avec des sous-graphes." />

On peut √©galement int√©grer des liens aux diagrammes MermaidJS.

```mermaid
flowchart LR
    A-->B
    B-->C
    C-->D
    click A callback "Tooltip for a callback"
    click B "https://www.github.com" "This is a tooltip for a link"
    click C call callback() "Tooltip for a callback"
    click D href "https://www.github.com" "This is a tooltip for a link"
```

Pas d'illustration ici, je n'ai pour le moment pas besoin d'int√©grer MermaidJS √† ce blog.

Je me suis attard√© ici sur les diagrammes de flux, mais MermaidJS permet de r√©aliser des diagrammes d‚Äôune vingtaine de types diff√©rents dont les plus fr√©quemment rencontr√©s sont les suivants :

- s√©quence
- √©tat
- classes
- Gantt
- camembert
- carte mentale
- timeline
- barre

On retrouve beaucoup de diagrammes directement li√©s au m√©tier de d√©veloppeur, mais certains ont un usage beaucoup plus large, comme les camemberts, les timelines et les diagrammes en barres.

## Aller plus loin
MermaidJS peut √™tre utilis√© en local via un terminal, mais il existe une grande vari√©t√© de moyens de l‚Äôutiliser autrement :

- le site web
- des plugins :
  - ChatGPT
  - Jira
  - Confluence
  - Visual Studio Code
  - la suite JetBrains
  - la suite Office (Word, Powerpoint)

Et la liste des int√©grations ne cesse de s‚Äôallonger, puisque sont d‚Äôores et d√©j√† pr√©vues des int√©grations pour Google Doc, Notion et Obsidian.

## S√©curit√©

Afin d‚Äôassurer la s√©curit√© de votre site web dans lequel vous avez int√©gr√© MermaidJS, on nous permet de r√©gler le degr√© de s√©curisation des diagrammes via un param√®tre de configuration nomm√© securityLevel. Ce param√®tre comprend 4 niveaux de s√©curit√© diff√©rents :

- strict (par d√©faut) : les balises html sont encod√©es mais le clic est d√©sactiv√©.
- antiscript : les balises html sont autoris√©es √† l‚Äôexception des balises script.
- loose : les balises html sont autoris√©es balises script comprises et le clic est activ√©.
- sandbox : tout est effectu√© dans une iframe isol√©e de la page. Cela emp√™che l‚Äôex√©cution de JavaScript dans le contexte, notamment les scripts, les popups, les liens etc.

Afin de r√©gler le niveau de s√©curit√© des diagrammes, vous devrez utiliser le script suivant :

```html
<script>
	mermaid.initialize({
	  securityLevel: 'lavaleurchoisie',
	});
</script>
```

## Conclusion

Maintenant que vous connaissez mieux MermaidJS, vous n‚Äôavez plus qu‚Äô√† le tester chez vous, ne vous reste que l‚Äôembarras du choix quant √† la mani√®re de l‚Äôutiliser ! √Ä l‚Äôusage, je dirais que le travail avec le terminal est un peu laborieux, n√©cessite de travailler avec plusieurs fichiers tandis que