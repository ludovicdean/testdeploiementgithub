---
title : "Cr√©er un blog avec Astro"
date : Feb 20 2024
tags :
    - Framework
    - Outils
description : "Astro, un compilateur de site web statique d'une simplicit√© enfantine"
banner : "./assets/images/arnel-hasanovic-MNd-Rka1o0Q-unsplash.webp"
readingtime : "5 min"
author : "Arnel Hasanovic"
authorlink : "https://unsplash.com/fr/@arnelhasanovic?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash"
unsplashlink : "https://unsplash.com/fr/photos/macbook-air-a-cote-dune-lampe-detude-doree-et-de-livres-a-spirale-MNd-Rka1o0Q?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash"
isArticle : true
---

import Picture from "@components/Picture.astro";

import astroarborescence from "../../assets/images/astro-arborescence.png";

La cr√©ation de ce blog m'a dans un premier temps fait d√©couvrir le compilateur de site web statique Jekyll. Ce choix a √©t√© guid√© par la documentation de github pour la cr√©ation de pages statiques.
Plusieurs connaissances m'ont conseill√© d'essayer Astro, vantant sa simplicit√© d'utilisation et la qualit√© de sa documentation.
Ma curiosit√© m'a pouss√© √† cr√©er un projet Astro en reprenant le contenu du blog et en le r√©adaptant aux sp√©cificit√©s de cet outil. Comme toujours j'ai r√©uni toutes les informations que j'ai trouv√© en un unique article, qui vous permettra normalement de mener √† bien votre projet.

Avant de poursuivre votre lecture, pr√©cision importante : ce blog a √©t√© cr√©√© avec la version **3.6.4**.

&nbsp;

## Pr√©-requis

2 √©l√©ments sont n√©cessaires :

- NodeJS
- Un √©diteur de code (Visual Studio Code dans mon cas, appel√© VSCode par la suite)

Avant de vous initier √† Astro, vous allez avoir besoin d'installer **NodeJS** (si ce n'est pas d√©j√† fait üòä). Si tel n'est pas le cas, vous pouvez vous rendre [ici](https://nodejs.org/en/download/current) pour t√©l√©charger l'installateur qui correspond √† votre syst√®me d'exploitation.

Une fois les √©tapes d'installation de NodeJS pass√©es, dans un terminal (un nouveau, sinon √ßa ne fonctionnera pas), saisir `node -v` ou `node --version`.
Le terminal devrait afficher la version de NodeJS install√©e sur votre ordinateur (dans mon cas, v20.9.0).

Cette v√©rification faite, vous pouvez passer √† la cr√©ation de votre blog √† proprement parler.

&nbsp;

## Cr√©ez votre blog

Avec Node est √©galement install√© le bien connu gestionnaire de packages **npm** (Node Package Manager). Ce gestionnaire de packages va vous permettre d'installer en local (sur votre machine) les composants logiciels n√©cessaires √† votre projet.

### √âtape 1 : le terminal

- Rendez-vous dans le dossier dans lequel vous souhaitez g√©n√©rer votre projet `cd monDossier/monSousDossier` (dossier imp√©rativement vide, contrainte d'Astro)
- Saisissez `npm create astro@latest`, validez puis saisissez `y` pour installer `create-astro`.
- Saisissez le nom de votre projet
- Choisissez votre template (touches üîº et üîΩ de votre clavier).
- Installez les d√©pendances
- N'installez pas TypeScript
- N'initialisez pas de repository Git.

### √âtape 2 : Visual Studio Code

- S√©lectionnez le dossier au nom de votre projet.
- Ouvrez un terminal et saisissez `npm run dev`.

C'est gagn√© ! Votre blog est disponible √† l'adresse indiqu√©e dans le terminal, √† l'adresse **localhost:4321** par d√©faut.

Une fois votre blog lanc√©, l'enregistrement d'un fichier entra√Ænera le rafra√Æchissement imm√©diat de l'ensemble du site, ce qui permet de voir rapidement vos derni√®res modifications.

Int√©ressons-nous maintenant √† la structure de notre projet.

&nbsp;

## Structure du projet

√Ä premi√®re vue notre projet Astro est assez simple.

<Picture image={astroarborescence} caption="Arborescence d'un projet Astro g√©n√©r√© automatiquement avec le template blog." />

Quelques dossiers aux noms familiers, node_modules, public, src, ainsi que quelques fichiers de configuration. D√©taillons maintenant le r√¥le et le contenu de ces diff√©rents √©l√©ments.

### node_modules

Ce dossier sert au stockage des d√©pendances du projet, c'est-√†-dire l'ensemble des scripts JavaScript n√©cessaires au bon fonctionnement du projet.

### public

Le dossier public a pour r√¥le le stockage des ressources statiques du site (images, vid√©os, polices d'√©criture etc.).

### src

Le r√©pertoire src contient quant √† lui le code source du site, l'ensemble des fichiers constituant les √©l√©ments n√©cessaires √† la structure du site, les pages web, les partial html, les fichiers de style, les trames des pages.

Dans notre cas, il contiendra les packages suivants :

- /components ‚û° les composants html de notre site (cr√©dits photographiques, en-t√™te, pied de page etc.)
- /pages ‚û° les pages qui composent le squelette du site (page d'accueil, √† propos etc.)
- /content ‚û° nos articles au format .mdx (format qui √©tend les fonctionnalit√©s originelles du markdown en permettant notamment l'utilisation de composants externes)
- /layouts ‚û° les trames de nos pages (articles, cat√©gories)

&nbsp;

### Les fichiers √† la racine

#### astro.config.mjs

C'est un fichier de configuration propre √† Astro, qui permet de personnaliser les options par d√©faut du projet.

#### package.json / package-lock.json

Le fichier package.json n'est pas propre √† Astro, il est au contraire commun √† tous les projets utilisant des packages node.
Il r√©f√©rence √©galement l'ensemble des d√©pendances du projet, avec leurs versions respectives. C'est gr√¢ce √† lui que npm est capable de r√©installer toutes ces d√©pendances sur une machine.

Le fichier package-lock.json est quant √† lui un instantan√© de ce qui a √©t√© install√© lors de la derni√®re installation du projet, lors du dernier `npm install`. Contrairement au package.json, avec lequel npm va pouvoir installer des versions plus r√©centes de certaines d√©pendances, le fichier lock va lui forcer √† installer les versions exactes de l'ensemble de ces d√©pendances, qu'il existe de nouvelles versions de celles-ci ou non.

#### config.ts

Ce fichier permet de configurer le projet sous plusieurs aspects :

- d√©finition les m√©ta-donn√©es du projet (nom, version, description, auteur etc.)
- configuration des plugins
- r√©pertoires source et de sortie
- d√©finition des variables d'environnement
- gestion des options de compilation et d'optimisation

Ceci n'est pas une liste exhaustive, mais c'est un bon d√©but üòä.

#### README

Son contenu est g√©n√©ralement un r√©sum√© du r√¥le d'un projet, ou l'explication de son fonctionnement. Ici, il s'agit d'un petit guide pour bien d√©marrer avec Astro.

#### tsconfig.json

Ce fichier sert √† l'√©diteur de code utilis√© √† savoir comment interpr√©ter un projet. Pour en savoir plus, vous pouvez vous r√©f√©rer √† la page correspondante de la documentation d'Astro, [ici](https://docs.astro.build/fr/guides/typescript/).

&nbsp;

## D√©couvrir Astro

Astro utilise des √©l√©ments communs √† d'autres g√©n√©rateurs de sites statiques, notamment les collections, le frontmatter, les layouts, mais il a surtout la particularit√© d'int√©grer nativement le mdx.
Faisons un tour d'horizon de ces fonctionnalit√©s.

### .mdx vs .md

Mdx, K√©zaco ?

Le mdx (Markdown with JSX) est en quelque sorte le grand fr√®re du md (Markdown). Il apporte de nombreuses fonctionnalit√©s li√©es au JSX (JavaScript XML) :

- l'int√©gration de composants html dans les fichiers mdx
- l'ajout d'√©l√©ments dynamiques dans les fichiers mdx
- la prise en charge de la logique conditionnelle
- la r√©utilisation des composants

En r√©sum√©, l√† o√π le Markdown est essentiellement une syntaxe simple et statique, le Markdown with JSX va √™tre plus complexe mais √©galement plus flexible et dynamique.

Typiquement, les cr√©dits photographiques pr√©sents √† la fin de chaque article sont g√©n√©r√©s par un composant html aliment√© par le frontmatter de chaque article.

### Les collections

De mani√®re similaire √† Jekyll, Astro g√®re des collections. Une collection est un ensemble de fichiers similaires situ√©s dans le m√™me sous-r√©pertoire du package **/content**. Lors de la g√©n√©ration du projet, Astro a configur√© la collection blog dans le fichier **config.ts**, qui correspond aux fichiers du r√©pertoire /content/blog.

Si vous souhaitez manipuler plusieurs types d'√©l√©ments (de fichiers), vous pouvez cr√©er une nouvelle collection en ajoutant une entr√©e dans le fichier config.ts, avec ses propri√©t√©s. Les attributs d'une collection peuvent √™tre des cha√Ænes de caract√®res, des nombres, des dates, des bool√©ens. Voici la configuration de mes articles de blog.

```
import { defineCollection, z } from 'astro:content';

const blog = defineCollection({
	// Type-check frontmatter using a schema
	schema: z.object({
		title: z.string(),
		description: z.string(),
		// Transform string to Date object
		date: z.coerce.date().optional(),
		banner: z.string().optional(),
		author: z.string().optional(),
		authorLink: z.string().optional(),
		unsplashLink: z.string().optional(),
		isArticle: z.boolean().optional(),
	}),
});

export const collections = { blog };
```

On voit que ma collection se nomme blog, que chaque √©l√©ment poss√®de obligatoirement un titre, une description, ainsi qu'un ensemble d'attributs optionnels (informations relatives aux cr√©dits photographiques, variables d'affichage etc.). 

### Le FrontMatter

Chaque article poss√®de un frontmatter dans lequel sont valoris√©s des attributs qui sont utilis√©s √† l'ext√©rieur de l'article, pour l'affichage sur la page d'accueil, pour les liens int√©gr√©s aux cr√©dits photographiques etc. 

```
---
title: "Cr√©er un blog avec Astro"
date: Dec 10 2023
description: "Astro, un compilateur de site web statique d'une simplicit√© enfantine"
banner: "/images/banner.jpg"
readingtime: "5 min"
author: "John Doe"
authorlink: "http://..."
unsplashlink: "http://..."
isArticle: true
---
```

Les propri√©t√©s du FrontMatter sont accessibles depuis l'ext√©rieur des fichiers. On peut voir ici comment sont utilis√©es ces propri√©t√©s pour afficher la liste des articles.

```html
<body>
    <Header />
    <main>
      <section>
        <ul>
          {
            posts.map((post) => (
              <li>
                <a href={`/blog/${post.slug}/`}>
                  <img width={720} height={360} src={post.data.banner} alt="" />
                  <h4 class="title">{post.data.title}</h4>
                  <p class="date">
                    <FormattedDate date={post.data.date} />
                  </p>
                </a>
              </li>
            ))
          }
        </ul>
      </section>
    </main>
    <Footer />
  </body>
```

On voit ici qu'on r√©cup√®re la collection de posts du site et que pour chaque post on g√©n√®re une balise li avec la banni√®re de l'article, son titre, sa date etc. On peut utiliser toutes les informations d√©finies dans le frontmatter de chaque article.

Si vous mettez en place des cat√©gories, vous passerez probablement par la cr√©ation d'une autre collection qui aura ses propres attributs, son propre layout, ses propres composants.

&nbsp;

## Les layouts

Un fichier de layout (mise en page) permet de centraliser le squelette de pages similaires, de disposer les diff√©rents √©l√©ments de notre page comme d√©sir√©. Pour un article de blog on aura la structure suivante :

```html
<html lang="en">
  <head>
    <BaseHead param1={value1} param2={value2} />
  </head>

  <body>
    <Header />
    <main>
      <article>
        <img class="hero-image" src="">
        <div class="prose">
          <div class="title">
            <h1>{title}</h1>
          </div>
          <slot />
          <CreditPhoto
            param1={value1}
            param2={value2}
            param3={value3}
            />
        </div>
      </article>
    </main>
    <Footer />
  </body>
</html>
```

Le layout appelle les composants dont il a besoin pour rendre la page (BaseHead, Header, CreditPhoto, Footer) ainsi que le contenu de l'article qui est affich√© √† la place de la balise `<slot />`.

Ainsi, la structure de vos articles n'a pas besoin d'√™tre g√©r√©e au sein de chaque article, mais une seule fois dans le fichier de mise en page. L'affichage des composants peut √™tre conditionn√© au sein d'un layout, et le passage de param√®tres √† un composant a lieu dans ce layout.

&nbsp;

## Les composants

Le principal atout du mdx est de permettre l'utilisation de composants. Mais comment fait-on pour cr√©er un composant ?

En r√©alit√©, vous utilisez des composants depuis le d√©but sans le savoir, ils sont l√† depuis le d√©but. L'en-t√™te (head, header) et le pied-de-page (footer) de votre blog sont des composants. Ils se trouvent dans le r√©pertoire **/src/components** de votre projet.

Un composant est un fichier .astro qui contient un fragment de html, destin√© √† √™tre utilis√© √† de multiples endroits dans votre blog. On peut distinguer deux types de composants :

- composant statique
- composant dynamique

Attention : les fichiers doivent imp√©rativement √™tre au format .mdx et non au format .md, sans quoi vos composants ne seront pas pris en compte.

&nbsp;

### Composants statiques

Le contenu d'un composant statique est fixe, il est utilis√© tel quel dans les autres pages (balise footer par exemple).

```html
---
const today = new Date();
---

<footer>
  &copy; {today.getFullYear()} Ludovic D√©an. All rights reserved.
  <div class="social-links">
    <a href="monUrl" target="_blank">
      <span class="sr-only">Go to Astro's GitHub repo</span>
      <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" >
        <path fill="currentColor" d="le contenu de mon svg"></path>
      </svg>
    </a>
  </div>
</footer>
<style>
  mesClassesCSS {
  }
</style>
```

Pour appeler un composant, on a besoin de l'importer dans le frontmatter de notre layout puis d'inclure la balise html correspondante dans le layout.

```html
---
import Footer from "../components/Footer.astro";
---

<Footer />
```

L'utilit√© de ce type de composant reste toutefois limit√©, car on ne peut pas l'adapter au contexte dans lequel on l'appelle. C'est ce que vont permettre les composants dynamiques.

### Composants dynamiques

Le contenu d'un composant dynamique est variable, chaque page qui l'appelle lui fournit des param√®tres qu'il va utiliser (CreditPhoto va recevoir plusieurs param√®tres).

```html
---
const { authorLink, author, unsplashLink } = Astro.props;
---

<div>
  <h3>Cr√©dits photographiques</h3>
  Photo de <a href="{lienAuteur}">{auteur}</a> sur
  <a href="{lienUnsplash}">Unsplash</a>
</div>
```

L'appel de ce composant sera r√©alis√© de la m√™me mani√®re que pour un composant statique, sauf que nous allons cette fois-ci lui passer des param√®tres (lienAuteur, auteur et lienUnsplash).

```html
---
lienAuteur: http://...
auteur: Untel
lienUnsplash: http://...

import Footer from "../components/Footer.astro";
---

<CreditPhoto
  lienAuteur={lienAuteur}
  auteur={auteur}
  lienUnsplash={lienUnsplash}
/>
```

Qu'il soit statique ou dynamique, on peut conditionner l'affichage d'un composant. La variable de gestion d'affichage est valoris√©e dans le frontmatter de chaque fichier et exploit√©e dans le fichier layout.

```html
---
showComposant: true
---

{ isArticle && (
<CreditPhoto
  lienAuteur={lienAuteur}
  auteur={auteur}
  lienUnsplash={lienUnsplash}
/>
) }
```

Ici, si isArticle vaut true, alors on affiche le composant CreditPhoto en lui passant les param√®tres n√©cessaires.

Certaines probl√©matiques n√©cessitent des √©l√©ments plus complexes, et comme r√©inventer la roue n'est pas toujours la meilleure id√©e, il est pr√©f√©rable de se tourner vers des solutions externes.

### Les plugins

Les int√©grations (plugins) Astro sont l√† pour r√©pondre √† des probl√©matiques communes √† de nombreux projets. Ces plugins sont r√©pertori√©s [ici](https://astro.build/integrations/), et un moteur de recherche permet de cibler les √©l√©ments affich√©s.

Sans trop rentrer dans le d√©tail, on y trouve toutes sortes d'int√©grations comme :

- pour les frameworks front :
  - React
  - Vue
  - Svelte
- pour le style :
  - TailwindCSS
  - BootStrap
- pour optimiser les performances de votre site :
  - imagetools
  - picperf
- pour g√©rer le d√©ploiement :
  - vercel
  - netlify

Vos besoins n'√©tant probablement pas uniques au monde, vous trouverez probablement votre bonheur parmi les nombreux plugins existant, et qui sait, peut-√™tre cr√©erez-vous votre propre plugin ?

&nbsp;

## Mettez votre site en ligne avec Github

La mise en ligne d'un site web Astro dont le d√©p√¥t est sur Github n√©cessite de mettre en place une Github Action. Nul besoin de retranscrire la documentation existante ([ici](https://docs.astro.build/en/guides/deploy/github/)) car elle est limpide et disponible en fran√ßais (menu en haut de la page).
Il suffit de suivre le mode op√©ratoire indiqu√© pour mettre en place le d√©ploiement du site. Il faudra prendre garde √† bien modifier les liens internes ainsi que les liens de vos ressources en ajoutant la base d√©finie dans le fichier astro.config.mjs dans les URLs.
Une fois les modifications effectu√©es, √† chaque commit sur la branche master de votre projet le site sera red√©ploy√©.

&nbsp;

## Conclusion

Mon exp√©rience avec Astro est v√©ritablement r√©ussie, la prise en main de l'outil √©tant assez rapide, avec une courbe d'apprentissage assez douce. On obtient rapidement un r√©sultat int√©ressant sans avoir v√©ritablement mis les mains dans le cambouis.

Si vous avez un projet de site web statique, je ne peux que vous recommander chaudement Astro, d'autant que la documentation est tr√®s fournie et tr√®s claire. Plus qu'une chose √† faire, lancez-vous üòâ !

Pour tout vous dire, j'ai moi-m√™me d√©cid√© de migrer d√©finitivement ce blog sur Astro üòä.